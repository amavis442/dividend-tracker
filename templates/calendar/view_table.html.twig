{% extends 'base.html.twig' %}

{% block title %}Calendar per date{% endblock %}

{% block body %}
<div class="container mb-2 p-3">
		<div class="border p-2">
<div><h3>Dividend payments per date for {{ year }} </h3><small class="text-muted">({{'Current date'|trans }}: {{ timestamp|format_date('full') }})</small></div>
</div>
</div>

	<div class="container mb-2 p-3">
		<div class="border p-2">
{{ form_start(form, {'attr': {'class':'form-inline'}}) }}
    <div class="form-group mb-3">
        {{ form_widget(form.startdate) }}
    </div>
    <div class="form-group mx-sm-3 mb-3">
        {{ form_widget(form.enddate) }}
    </div>
    <div class="form-group mx-sm-3 mb-3">
        {{ form_widget(form.pie) }}
    </div>

    <button type="submit" class="btn btn-secondary mb-2">
        <i class="fas fa-solid fa-filter"></i>
    </button>
{{ form_end(form) }}

{% if calendars %}
    <table class="table table-striped">
    <tr>
        <th></th>
        <th>{{ 'Pay date'|trans }}</th>
        <th>{{ 'Company'|trans }}</th>
        <th>{{ 'Dividend'|trans }}</th>
        <th>{{ 'Net dividend'|trans }}</th>
    </tr>
    {% for month,items in calendars %}
        {% set sumDividend = 0.0 %}
        {% set numPositions = 1 %}
        <tr class="table-dark">
            <th>#</th>
            <th colspan="5">
                {% set chosenDate = month|slice(0,4) ~ '-' ~ month|slice(4,2) ~ '-01' %}
                {{ chosenDate|date('F')|trans }}, {{ month|slice(0,4) }}
            </th>
        </tr>
        {% for day, item in items %}
            {% for key, calData in item %}
                {% set cal = calData.calendar %}
                {% set netDividend = calData.positionDividend %}
                {% set estimatedAmount = calData.positionAmount %}
                    {% set currentDate = cal.getPaymentDate %}
                    <tr>
                        <td>{{ numPositions}}</td>
                        <th>{{ currentDate|date('l')|trans }}, {{ currentDate|date('d') }} {{ currentDate|date('F')|trans|lower }} {{ currentDate|date('Y') }}</th>
                        <td>
                            {% set tickerInfo  = '' %}
                            {% set tickerInfo %}
                                Ticker: {{ calData.ticker }}<br/>
                                {{ 'Tax rate'|trans }}: {{ calData.taxRate * 100 }}% <br/>
                                {{ 'Exchangerate'|trans }}: {{ calData.exchangeRate|format_number({fraction_digit: 4}) }}<br/>
                                {{ 'Tax'|trans }}: &euro;{{ (calData.tax * estimatedAmount)|format_number({fraction_digit: 2}) }}<br/>
                                Ex-div: {{ calData.calendar.exDividendDate|date('D d-m-Y') }}
                            {% endset %}
                            {{ cal.ticker.fullname }} <i class="fas fa-info-circle"
                                data-toggle="tooltip"
                                data-html="true"
                                data-placement="right"
                                title="{{ tickerInfo }}">
                                </i>
                            <br/>
                            <small>{{ estimatedAmount|format_number({fraction_digit: 7}) }} {{ 'shares'|trans }}</small>
                        </td>
                        <td>
                            {{ cal.currency.sign|raw}}{{ cal.cashAmount|format_number({fraction_digit: 2}) }}
                        </td>
                        <td>&euro;{{ netDividend|format_number({fraction_digit: 2}) }}</td>
                    </tr>
                    {% set sumDividend = sumDividend + netDividend %}
                    {% set numPositions = numPositions  + 1 %}
            {% endfor %}
        {% endfor %}
        <tr>
            <td colspan="3"></td>
            <th>{{ 'Total'|trans }}</th>
            <th>&euro;{{ sumDividend|format_number({fraction_digit: 2}) }}</th>
        </tr>
    {% endfor %}
    </table>
{% else %}
    no items
{% endif %}

<a href="{{ path('calendar_index') }}" class="btn btn-primary"><i class="fas fa-angle-double-left"></i> {{ 'back to list'|trans }}</a>
</div>
</div>
{% endblock %}
