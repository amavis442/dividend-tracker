{% extends 'base.html.twig' %}

{% block title %}Ticker
{% endblock %}

{% block body %}
	<h1>Ticker</h1>

	<table class="table">
		<tbody>
			<tr>
				<th>Ticker</th>
				<td><strong>{{ ticker.ticker }}</strong></td>
			</tr>
			<tr>
				<th>Fullname</th>
				<td>{{ ticker.fullname }}</td>
			</tr>
            <tr>
				<th>Industry</th>
				<td>{{ ticker.branch.label }}</td>
			</tr>
			<tr>
				<th>Positions</th>
				<td>
					<table class="table table-striped">
						<thead>
							<tr>
								<th></th>
								<th>Units</th>
								<th>Price</th>
								<th>Allocation</th>
								<th>Transaction date</th>
								<th>Broker</th>
								<th>Actions</th>
						</tr>
						</thead>
						{% for position in positions %}
							<tr class="table-primary">
								<td><strong>Summary</strong></td>
								<td>{{ (position.amount/100)|format_number({fraction_digit: 2}) }}</td>
								<td>{{ (position.currency ? position.currency.sign : '$')|raw }}{{ (position.price/100)|format_number({fraction_digit: 2}) }}</td>
								<td>{{ (position.allocationCurrency ? position.allocationCurrency.sign : '$')|raw }}{{ (position.allocation/100)|format_number({fraction_digit: 2}) }}</td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							{% for transaction in position.transactions %}
							{% set side = (transaction.side == 1 ? 'Buy' : 'Sell') %}
							<tr>
								<td>
									<span class="badge badge-{% if transaction.side == 1 %}success{% else %}danger{% endif %}">
										{{ side }}
									</span>
								</td>
								<td>{{ (transaction.amount/100)|format_number({fraction_digit: 2}) }}</td>
								<td>{{ (transaction.currency ? transaction.currency.sign : '$')|raw }}{{ (transaction.price/100)|format_number({fraction_digit: 2}) }}</td>
								<td>{{ (transaction.allocationCurrency ? position.allocationCurrency.sign : '$')|raw }}{{ (transaction.allocation/100)|format_number({fraction_digit: 2}) }}</td>
								<td>{{ transaction.transactionDate|date("d-m-Y") }}</td>
								<td>{{ transaction.broker }}</td>
								<td>
									<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                            			<div class="btn-group mr-2" role="group" aria-label="First group">
                                			<a href="{{ path('transaction_edit', {'id': transaction.id}) }}" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Edit transaction">
                                    			<i class="far fa-edit"></i>
                                			</a>
                                   		</div>
                        			</div>
								</td>
							</tr>
							{% endfor %}
						{% else %}
							no records found
						{% endfor %}
					</table>
				</td>
			</tr>
			<tr>
				<th>Research info</th>
				<td>
					{% for research in ticker.researches %}

						<p>
							<div class="card" style="width: 100%;">
								<div class="card-body">
									<h5 class="card-title">
										{{ research.title }}</h5>
									<p class="card-text">{{ research.info|raw }}</p>
									{% if research.hasFiles %}
										<p>
											{% for doc in research.files %}
												<a href="{{ asset('uploads/documents/' ~ doc.filename) }}" target='_blank'>View document</a><br/>
											{% endfor %}
										</p>
									{% endif %}
									<hr/>
									<a href="{{ path('research_edit', {'id': research.id}) }}" class="card-link">
										<i class="far fa-edit"></i>
									</a>
								</div>
							</div>
						</p>
					{% else %}
						no records found
					{% endfor %}
				</td>
			</tr>
		</tbody>
	</table>

	<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
		<div class="btn-group mr-2" role="group" aria-label="First group">
			<a href="{{ path('portfolio_index') }}" class="btn btn-secondary">
				<i class="fas fa-angle-double-left"></i>
				back to list</a>
		</div>
		<div class="btn-group mr-2" role="group" aria-label="Second group">
			<a href="{{ path('ticker_edit', {'id': ticker.id}) }}" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Edit ticker">
				<i class="far fa-edit"></i>
			</a>
			<a class="btn btn-primary" href="{{ path('research_new', {'ticker': ticker.id}) }}" data-toggle="tooltip" data-placement="top" title="add research">
				<i class="fab fa-searchengin"></i>
			</a>
		</div>
	</div>
	<hr/>
{% endblock %}
